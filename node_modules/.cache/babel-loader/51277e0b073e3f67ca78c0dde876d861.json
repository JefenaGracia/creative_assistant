{"ast":null,"code":"var _jsxFileName = \"/Users/jefenaprakash/creative_assistant/ca_login/src/components/ManageClassroom.js\";\nimport React, { useState, useEffect } from 'react';\nimport { db } from '../firebaseConfig';\nimport { collection, doc, getDocs, setDoc, deleteDoc, getDoc } from 'firebase/firestore';\nimport * as XLSX from 'xlsx';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport './ManageClassroom.css';\nconst ManageClassroom = () => {\n  const [students, setStudents] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [fileError, setFileError] = useState(null); // For displaying file upload errors\n  const {\n    classroomId\n  } = useParams();\n  const navigate = useNavigate();\n\n  // Fetching the list of students from the classroom\n  useEffect(() => {\n    const fetchClassroomStudents = async () => {\n      try {\n        const classroomRef = doc(db, 'classrooms', classroomId);\n        const studentsCollection = collection(classroomRef, 'students');\n        const querySnapshot = await getDocs(studentsCollection);\n        setStudents(querySnapshot.docs.map(doc => doc.data()));\n        setLoading(false);\n      } catch (error) {\n        console.error('Error fetching students:', error);\n        setLoading(false);\n      }\n    };\n    fetchClassroomStudents();\n  }, [classroomId]);\n\n  // Handle removing a student from the classroom\n  const handleStudentRemove = async email => {\n    try {\n      const classroomRef = doc(db, 'classrooms', classroomId);\n      const studentRef = doc(classroomRef, 'students', email);\n      await deleteDoc(studentRef);\n      setStudents(students.filter(student => student.email !== email));\n    } catch (error) {\n      console.error('Error removing student:', error);\n    }\n  };\n\n  // Handle file upload to add students\n  const handleFileUpload = e => {\n    const file = e.target.files[0];\n    const reader = new FileReader();\n    reader.onload = async event => {\n      try {\n        setFileError(null); // Reset error before reading file\n        const fileData = event.target.result;\n        const workbook = XLSX.read(fileData, {\n          type: 'array'\n        });\n        const sheet = workbook.Sheets[workbook.SheetNames[0]];\n        const jsonData = XLSX.utils.sheet_to_json(sheet);\n        const newStudents = await processStudents(jsonData);\n        setStudents(prevStudents => [...prevStudents, ...newStudents]);\n\n        // Redirect to the classroom details page after adding students\n        navigate(`/classroom/${classroomId}`);\n      } catch (error) {\n        setFileError('Error reading file. Please make sure the file is in a valid format.');\n        console.error('Error reading file:', error);\n      }\n    };\n    reader.readAsArrayBuffer(file);\n  };\n\n  // Refactor student processing\n  const processStudents = async jsonData => {\n    const classroomRef = doc(db, 'classrooms', classroomId);\n    const newStudents = [];\n    for (const row of jsonData) {\n      const {\n        'Student Email': email,\n        'First name': firstName,\n        'Last name': lastName\n      } = row;\n      if (email && firstName && lastName) {\n        const studentRef = doc(collection(classroomRef, 'students'), email);\n        const studentSnap = await getDoc(studentRef);\n        if (!studentSnap.exists()) {\n          await setDoc(studentRef, {\n            email,\n            firstName,\n            lastName\n          });\n          newStudents.push({\n            email,\n            firstName,\n            lastName\n          });\n        } else {\n          console.log(`Student with email ${email} already exists.`);\n        }\n      }\n    }\n    return newStudents;\n  };\n  if (loading) return /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 23\n    }\n  }, \"Loading students...\");\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"manage-classroom\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h2\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 7\n    }\n  }, \"Manage Students\"), /*#__PURE__*/React.createElement(\"input\", {\n    type: \"file\",\n    accept: \".xlsx,.csv\",\n    onChange: handleFileUpload,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 7\n    }\n  }), fileError && /*#__PURE__*/React.createElement(\"p\", {\n    className: \"error\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 21\n    }\n  }, fileError), \" \", /*#__PURE__*/React.createElement(\"div\", {\n    className: \"student-list\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 7\n    }\n  }, students.length > 0 ? students.map(student => /*#__PURE__*/React.createElement(\"div\", {\n    key: student.email,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 15\n    }\n  }, student.lastName, \", \", student.firstName), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: () => handleStudentRemove(student.email),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 15\n    }\n  }, \"Remove\"))) : /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 11\n    }\n  }, \"No students in this classroom yet.\")));\n};\nexport default ManageClassroom;","map":{"version":3,"names":["React","useState","useEffect","db","collection","doc","getDocs","setDoc","deleteDoc","getDoc","XLSX","useNavigate","useParams","ManageClassroom","students","setStudents","loading","setLoading","fileError","setFileError","classroomId","navigate","fetchClassroomStudents","classroomRef","studentsCollection","querySnapshot","docs","map","data","error","console","handleStudentRemove","email","studentRef","filter","student","handleFileUpload","e","file","target","files","reader","FileReader","onload","event","fileData","result","workbook","read","type","sheet","Sheets","SheetNames","jsonData","utils","sheet_to_json","newStudents","processStudents","prevStudents","readAsArrayBuffer","row","firstName","lastName","studentSnap","exists","push","log","createElement","__self","__source","fileName","_jsxFileName","lineNumber","columnNumber","className","accept","onChange","length","key","onClick"],"sources":["/Users/jefenaprakash/creative_assistant/ca_login/src/components/ManageClassroom.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { db } from '../firebaseConfig';\nimport { collection, doc, getDocs, setDoc, deleteDoc, getDoc } from 'firebase/firestore';\nimport * as XLSX from 'xlsx';\nimport { useNavigate, useParams } from 'react-router-dom';\nimport './ManageClassroom.css';\n\nconst ManageClassroom = () => {\n  const [students, setStudents] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [fileError, setFileError] = useState(null); // For displaying file upload errors\n  const { classroomId } = useParams();\n  const navigate = useNavigate();\n\n  // Fetching the list of students from the classroom\n  useEffect(() => {\n    const fetchClassroomStudents = async () => {\n      try {\n        const classroomRef = doc(db, 'classrooms', classroomId);\n        const studentsCollection = collection(classroomRef, 'students');\n        const querySnapshot = await getDocs(studentsCollection);\n        setStudents(querySnapshot.docs.map(doc => doc.data()));\n        setLoading(false);\n      } catch (error) {\n        console.error('Error fetching students:', error);\n        setLoading(false);\n      }\n    };\n\n    fetchClassroomStudents();\n  }, [classroomId]);\n\n  // Handle removing a student from the classroom\n  const handleStudentRemove = async (email) => {\n    try {\n      const classroomRef = doc(db, 'classrooms', classroomId);\n      const studentRef = doc(classroomRef, 'students', email);\n      await deleteDoc(studentRef);\n      setStudents(students.filter(student => student.email !== email));\n    } catch (error) {\n      console.error('Error removing student:', error);\n    }\n  };\n\n  // Handle file upload to add students\n  const handleFileUpload = (e) => {\n    const file = e.target.files[0];\n    const reader = new FileReader();\n\n    reader.onload = async (event) => {\n      try {\n        setFileError(null); // Reset error before reading file\n        const fileData = event.target.result;\n        const workbook = XLSX.read(fileData, { type: 'array' });\n        const sheet = workbook.Sheets[workbook.SheetNames[0]];\n        const jsonData = XLSX.utils.sheet_to_json(sheet);\n\n        const newStudents = await processStudents(jsonData);\n        setStudents((prevStudents) => [...prevStudents, ...newStudents]);\n\n        // Redirect to the classroom details page after adding students\n        navigate(`/classroom/${classroomId}`);\n      } catch (error) {\n        setFileError('Error reading file. Please make sure the file is in a valid format.');\n        console.error('Error reading file:', error);\n      }\n    };\n\n    reader.readAsArrayBuffer(file);\n  };\n\n  // Refactor student processing\n  const processStudents = async (jsonData) => {\n    const classroomRef = doc(db, 'classrooms', classroomId);\n    const newStudents = [];\n\n    for (const row of jsonData) {\n      const { 'Student Email': email, 'First name': firstName, 'Last name': lastName } = row;\n\n      if (email && firstName && lastName) {\n        const studentRef = doc(collection(classroomRef, 'students'), email);\n        const studentSnap = await getDoc(studentRef);\n\n        if (!studentSnap.exists()) {\n          await setDoc(studentRef, { email, firstName, lastName });\n          newStudents.push({ email, firstName, lastName });\n        } else {\n          console.log(`Student with email ${email} already exists.`);\n        }\n      }\n    }\n    return newStudents;\n  };\n\n  if (loading) return <p>Loading students...</p>;\n\n  return (\n    <div className=\"manage-classroom\">\n      <h2>Manage Students</h2>\n      {/* File upload for adding students */}\n      <input type=\"file\" accept=\".xlsx,.csv\" onChange={handleFileUpload} />\n      {fileError && <p className=\"error\">{fileError}</p>} {/* Display file error */}\n\n      {/* List of students */}\n      <div className=\"student-list\">\n        {students.length > 0 ? (\n          students.map((student) => (\n            <div key={student.email}>\n              <p>{student.lastName}, {student.firstName}</p>\n              <button onClick={() => handleStudentRemove(student.email)}>Remove</button>\n            </div>\n          ))\n        ) : (\n          <p>No students in this classroom yet.</p>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default ManageClassroom;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}